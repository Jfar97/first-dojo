#!/usr/local/bin/python

import random
import string
import subprocess
from pathlib import Path

DIR = Path(__file__).resolve().parent

C_FILE = DIR / "executable.c"     # <-- your actual C filename
OUT_BIN = DIR / "challenge"       # <-- must be "challenge" for the platform
EXPECTEDKEY = DIR / "expected_key"

def rand_word(min_len=6, max_len=12):
    alphabet = string.ascii_lowercase
    L = random.randint(min_len, max_len)
    return "".join(random.choice(alphabet) for _ in range(L))

def cpp_define_arg(name: str, value: str) -> str:
    # subprocess.run([...]) does not need shell escaping
    return f'-D{name}="{value}"'

def main():
    vals = {f"S{i}": rand_word() for i in range(1, 16)}

    cmd = [
        "gcc",
        "-g", "-O0", "-Wall", "-Wextra",
        *[cpp_define_arg(k, v) for k, v in vals.items()],
        "-o", str(OUT_BIN),
        str(C_FILE),
    ]
    subprocess.run(cmd, check=True)

    expected_key = "".join(vals[f"S{i}"] for i in range(1, 10))
    EXPECTEDKEY.write_text(expected_key + "\n", encoding="utf-8")

if __name__ == "__main__":
    main()
